let loggedInCustomer,apiUrl="http://p2terminusoms-env.eba-fcyktpid.us-east-1.elasticbeanstalk.com";getLoggedInCustomer();let editAccountContainer=document.getElementById("editAccountContainer");async function fetchAccountInfo(){editAccountContainer.innerHTML="";let e=await fetch(apiUrl+"/customer/"+loggedInCustomer.id);accountForm(await e.json())}async function putAccountInfo(e,t,n,o){let i={firstname:e,lastname:t,email:n},r=await fetch(apiUrl+"/customer/"+loggedInCustomer.id,{method:"PUT",body:JSON.stringify(i),headers:new Headers({"Content-Type":"application/json",Auth:sessionStorage.getItem("terminus-tkn")})});r.ok?message("success","Your account information has been saved"):message("alert",`Cannot update your account information (Code: ${r.status})`)}function accountForm(e){let t=document.createElement("h1");t.style.marginTop="1.5em",t.innerHTML='<i class="fa-duotone fa-file-user" style="margin-right:0.5em;"></i> Account Info';let n=document.createElement("div");n.setAttribute("class","formDiv2");let o=document.createElement("div");o.setAttribute("class","msg");let i=document.createElement("input");i.setAttribute("id","fname"),i.setAttribute("class","edit"),i.setAttribute("type","text"),i.value=e.firstname;let r=document.createElement("input");r.setAttribute("id","lname"),r.setAttribute("class","edit"),r.setAttribute("type","text"),r.value=e.lastname;let a=document.createElement("input");a.setAttribute("id","email"),a.setAttribute("class","edit"),a.setAttribute("type","text"),a.value=e.email;let s=document.createElement("button");s.style.fontSize="unset",s.style.marginTop="1em",s.innerText="Update Account",s.addEventListener("click",(function(){putAccountInfo(i.value,r.value,a.value,o)}));let l=document.createElement("button");l.setAttribute("class","closeBtn"),l.style.fontSize="unset",l.style.marginTop="1em",l.innerText="Close Account",l.addEventListener("click",(function(){confirmClose(loggedInCustomer.id)})),n.appendChild(o),n.appendChild(i),n.appendChild(r),n.appendChild(a),n.appendChild(s),n.appendChild(l),editAccountContainer.appendChild(t),editAccountContainer.appendChild(n),document.getElementById("contentContainer").style.display="none",document.getElementById("storeContainer").style.display="none",document.getElementById("storeItemContainer").style.display="none",document.getElementById("cartContainer").style.display="none",document.getElementById("orderContainer").style.display="none",document.getElementById("orderHistoryItemContainer").style.display="none",document.getElementById("editAccountContainer").style.display="inline-block"}function confirmClose(e){let t="Are you sure you want to cancel your order?";1==confirm(t)?closeAccount(e):t="You canceled!"}async function closeAccount(e){(await fetch(apiUrl+"/customer/"+e,{method:"DELETE"})).ok&&logOut()}async function getLoggedInCustomer(){let e=sessionStorage.getItem("terminus-id");if(e){let t=await fetch(apiUrl+"/customer/"+e,{headers:new Headers({Auth:sessionStorage.getItem("terminus-tkn")})});t.ok&&(loggedInCustomer=await t.json())}loggedInCustomer?showLoggedInDisplay():showLoggedOutDisplay()}function showLoggedInDisplay(){document.getElementById("accountNav").style.opacity="1",document.getElementById("cartNav").style.display="inline-block",document.getElementById("topLoginBtn").style.display="none",document.getElementById("topSignupBtn").style.display="none"}function showLoggedOutDisplay(){document.getElementById("accountNav").style.opacity="0",document.getElementById("cartNav").style.display="none",document.getElementById("topLoginBtn").style.display="inline-block",document.getElementById("topSignupBtn").style.display="inline-block"}function logOut(){loggedInCustomer=null,sessionStorage.clear(),showLoggedOutDisplay(),main(),message("info","You have been logged out.")}async function login(){document.getElementById("msg").innerText="";let e=document.getElementById("username").value,t=document.getElementById("password").value;if(!e|!t)return void message("alert","Username and password fields are required");let n={username:e,password:t},o=await fetch(apiUrl+"/auth",{method:"POST",body:JSON.stringify(n),headers:new Headers({"Content-Type":"application/json"})});200===o.status?(loggedInCustomer=await o.json(),loggedInCustomer&&(sessionStorage.setItem("terminus-tkn",o.headers.get("Auth")),sessionStorage.setItem("terminus-id",loggedInCustomer.id),window.location.href="./index.html")):message("alert","Incorrect credentials. Please try again.")}let date=(new Date).toLocaleDateString();async function createOrder(){let e,t=0;for(let n of cart)n.id&&(e=n.price,t+=parseInt(e));let n={customerId:loggedInCustomer.id,orderDate:date,totalPrice:t},o=[],i=await fetch(apiUrl+"/order",{method:"POST",body:JSON.stringify(n),headers:new Headers({"Content-Type":"application/json"})});if(201===i.status){if(orderReturn=await i.json(),orderReturn){for(let e of cart){let t=orderReturn.orderId,n=`https://fakestoreapi.com/products/${e.id}`;o.push({orderId:t,endpoint:n})}for(let e of o)saveProducts(JSON.stringify(e));cart=[],showOrders(),message("success","Your order has been placed!")}}else message("error","Sorry we couldn't place your order!")}async function saveProducts(e){loggedInCustomer&&(await fetch(apiUrl+"/product/",{method:"POST",body:e,headers:new Headers({"Content-Type":"application/json"})})).ok}async function showOrders(){let e=document.getElementById("orderContainer");e.innerHTML="",e.style.display="inline-block";let t=document.createElement("h1");t.innerHTML='<i class="fa-duotone fa-clock-rotate-left" style="margin-right:0.5em;"></i> Your Order History',t.style.marginTop="1.5em",e.appendChild(t),getOrderJson().then((t=>{t.reverse().forEach((t=>{let n=document.createElement("div");n.setAttribute("class","orderItem");let o=document.createElement("div");n.setAttribute("class","productItem");let i=document.createElement("p");i.innerHTML=`Order #: ${t.orderId}`;let r=document.createElement("p");r.innerHTML=`Ordered On ${t.orderDate}`;let a=document.createElement("p");a.innerHTML=`<b>Total:</b> $${t.totalPrice}`,o.appendChild(i),o.appendChild(r),o.appendChild(a),n.appendChild(o);let s=document.createElement("div");s.setAttribute("class","xButton"),s.style.display="inline-block",s.style.float="right",s.style.marginTop="-5.5em",s.style.marginRight="1em",s.innerText="View Order",s.addEventListener("click",(()=>{getOrderProducts(t.orderId)})),n.appendChild(s),e.appendChild(n)}));let n=document.createElement("div");n.style.fontSize="20px",n.style.marginTop="2em",n.innerHTML="You have no previous order history...",0===t.length&&e.appendChild(n)})),document.getElementById("contentContainer").style.display="none",document.getElementById("storeContainer").style.display="none",document.getElementById("storeItemContainer").style.display="none",document.getElementById("cartContainer").style.display="none",document.getElementById("orderHistoryItemContainer").style.display="none",document.getElementById("editAccountContainer").style.display="none",document.getElementById("orderContainer").style.display="inline-block"}async function getOrderJson(){let e=await fetch(apiUrl+"/customer/"+loggedInCustomer.id),t=await e.json();if(e.ok)return t.orders}async function getOrderProducts(e){let t=await fetch(apiUrl+"/order/"+e);showOrderProducts(await t.json())}function confirmCancel(e){let t="Are you sure you want to cancel your order?";1==confirm(t)?cancelOrder(e):t="You canceled!"}async function cancelOrder(e){(await fetch(apiUrl+"/order/"+e,{method:"DELETE"})).ok&&(showOrders(),message("info","Your order has been canceled"))}async function fetchEndpoint(e){let t=await fetch(e);return await t.json()}function showOrderProducts(e){document.getElementById("orderHistoryItemContainer").innerHTML="";let t=document.createElement("div"),n=document.createElement("h2");n.style.margin="0.5em 0 1.5em 0",n.style.fontSize="unset",n.innerHTML=`<i class="fa-duotone fa-cart-circle-check" style="margin-right:0.5em;"></i> Order # ${e.orderId} placed on ${e.orderDate}`,t.appendChild(n);let o=document.createElement("div"),i=document.createElement("div");i.setAttribute("class","totalOrderPrice"),i.innerHTML=`Total Price $${e.totalPrice}`;let a,s,l,d,c,m=document.createElement("div");for(r of(a=document.createElement("div"),s=document.createElement("div"),d=document.createElement("div"),e.products))fetchEndpoint(r.endpoint).then((e=>{l=document.createElement("div"),c=document.createElement("h3"),c.style.fontWeight="300",c.style.margin="1em",c.innerHTML=`${e.title} <span style="float:right;">$${e.price}</span>`,o.appendChild(c),t.setAttribute("id","singleOrderDiv"),m.setAttribute("class","row"),a.setAttribute("class","column"),s.setAttribute("class","column"),m.appendChild(a),m.appendChild(s),l.setAttribute("class","productImage"),l.style.backgroundImage=`url('${e.image}')`,l.style.display="inline-block",l.style.marginRight="1em",l.style.padding="3em",l.style.border="5px #ffffff solid",a.appendChild(l),d.setAttribute("class","xButton"),d.style.display="inline-block",d.style.marginTop="1em",d.innerHTML="Cancel Order",d.style.float="right"}));d.addEventListener("click",(function(){confirmCancel(e.orderId)})),s.appendChild(d),t.appendChild(m),t.appendChild(o),t.appendChild(i),document.getElementById("orderHistoryItemContainer").appendChild(t),document.getElementById("orderContainer").style.display="none",document.getElementById("contentContainer").style.display="none",document.getElementById("storeContainer").style.display="none",document.getElementById("storeItemContainer").style.display="none",document.getElementById("cartContainer").style.display="none",document.getElementById("orderHistoryItemContainer").style.display="inline-block",document.getElementById("editAccountContainer").style.display="none"}const api_url="https://fakestoreapi.com/products/";let catBtn=document.getElementById("categoryBtn"),cartBtn=document.getElementById("cartBtn"),storeBtn=document.getElementById("storeNav"),storeRows=document.getElementById("storeRows"),tbodyRef=document.getElementById("storeRows").getElementsByTagName("tbody")[0],cart=[];function getStore(){getAllProducts(api_url)}async function getAllProducts(e){let t=await fetch(e),n=await t.json();t&&hideloader(),showAllProducts(n)}async function getProduct(e){let t=await fetch(`${api_url}${e}`),n=await t.json();t&&hideloader(),showProduct(n)}function showProduct(e){let t="";t+=`\n        <div id="singleProductDiv">\n\n        <h1 class="productTitle">${e.title}</h1>\n        <h3>Category: ${e.category}</h3>\n\n        <div class="row">\n\n        <div class="column">\n        <div class="singleProductImage" style="background-image: url('${e.image}');"></div>\n        </div>\n        <div class="column">\n        ${e.description}\n\n        <div class="singlePriceBox">\n        <h3 style="margin-top:2em;margin-bottom:8px;">$${e.price}</h3>\n        ${e.rating.rate} (${e.rating.count} ratings)\n        <div id="cartBtn" onclick="update_cart(${e.id}, 1, '${e.title.replace(/["']/g,"")}', ${e.price}, '${e.image}');" style="margin-top:1em;width: fit-content;width:200px !important;" class="xButton" href="#">Add to Cart <i style="margin-left:0.7em;font-size:smaller;" class="fa-duotone fa-cart-shopping"></i></div>\n        </div>\n        </div>\n        </div>\n        </div>\n        `,document.getElementById("contentContainer").style.display="none",document.getElementById("storeContainer").style.display="none",document.getElementById("storeItemContainer").style.display="inline-block",document.getElementById("storeItemContainer").innerHTML=t,document.getElementById("cartContainer").style.display="none",document.getElementById("orderContainer").style.display="none",document.getElementById("orderHistoryItemContainer").style.display="none",document.getElementById("editAccountContainer").style.display="none"}function showAllProducts(e){$("#storeRows tbody").empty();for(let t of e){let e=tbodyRef.insertRow().insertCell(),n=document.createElement("div");n.setAttribute("id","productDiv");let o=document.createElement("h1");o.setAttribute("class","productTitle"),o.setAttribute("onClick",`javascript: getProduct('${t.id}');`);let i=document.createTextNode(t.title);o.appendChild(i);let r=document.createElement("div");r.setAttribute("class","productImage"),r.style.backgroundImage=`url('${t.image}')`;let a=document.createElement("div");a.style.float="right",a.style.marginTop="-8em",a.innerHTML=`\n        <h3 style="margin-bottom:8px;">$${t.price}</h3>\n        ${t.rating.rate} (${t.rating.count} ratings)\n        <div style="margin-top:1em;" class="xButton" onclick='getProduct(${t.id})'>View Product <i style="margin-left:0.4em;" class="fa-duotone fa-square-arrow-up-right"></i></div>\n        `,n.appendChild(o),n.appendChild(r),n.appendChild(a),e.appendChild(n)}document.getElementById("contentContainer").style.display="none",document.getElementById("storeContainer").style.display="inline-block",document.getElementById("storeItemContainer").style.display="none",document.getElementById("cartContainer").style.display="none",document.getElementById("orderContainer").style.display="none",document.getElementById("orderHistoryItemContainer").style.display="none",document.getElementById("editAccountContainer").style.display="none"}function hideloader(){document.getElementById("loading").style.display="none"}storeBtn&&storeBtn.addEventListener("click",getStore),cartBtn&&cartBtn.addEventListener("click",addCart),$(document).ready((function(){$("#filterSearch").on("keyup",(function(){let e=$(this).val().toLowerCase();$("#storeRows tr").filter((function(){$(this).toggle($(this).text().toLowerCase().indexOf(e)>-1)}))}))}));const update_cart=(e,t,n,o,i)=>{let r=cart.find((t=>t.id===e));r?r.quantity=r.quantity+t:cart.push({id:e,name:n,price:o,img:i}),document.getElementById("cartNav").animate([{transform:"translateY(-24px)",animationTimingFunction:"ease-out",transformOrigin:"center center"},{transform:"translateY(0)",animationTimingFunction:"ease-in"},{transform:"translateY(-14px)",animationTimingFunction:"ease-out"},{transform:"translateY(0)",animationTimingFunction:"ease-in"},{transform:"translateY(-8px)",animationTimingFunction:"ease-out"},{transform:"transform: translateY(0px)",animationTimingFunction:"ease-out"}],{duration:850,iterations:1}),document.getElementById("cartBtn").animate([{transform:"scale3d(1, 1, 1)"},{transform:"scale3d(1.25, 0.75, 1)"},{transform:"scale3d(0.75, 1.25, 1)"},{transform:"scale3d(1.15, 0.85, 1)"},{transform:"scale3d(0.95, 1.05, 1)"},{transform:"scale3d(1.05, 0.95, 1)"},{transform:"scale3d(1, 1, 1)"},{background:"#2f4d70"}],{duration:850,iterations:1}),document.getElementById("cartBtn").innerHTML="Added <i style='margin-left:0.7em;font-size:smaller;' class='fa-duotone fa-circle-check'></i>",document.getElementById("cartBtn").style.backgroundColor="#2f4d70",document.getElementById("cartBtn").setAttribute("class","xButton disabled")};function removeIndexCart(e){cart.splice(e,1),getCart()}function getCart(){let e=document.getElementById("cartContainer");e.innerHTML="";let t,n,o=document.createElement("h1");o.innerHTML='<i class="fa-duotone fa-cart-shopping-fast" style="margin-right:0.5em;"></i> Your Shopping Cart',o.style.marginTop="1.5em",e.appendChild(o);for(const[o,i]of Object.entries(cart)){n=document.createElement("div"),t=document.createElement("div");let r=document.createElement("div"),a=document.createElement("div");n.setAttribute("class","row"),r.setAttribute("class","column"),r.style.width="12%",a.style.width="88%",a.setAttribute("class","column"),t.setAttribute("class","cartItem"),productImage=document.createElement("div"),productImage.setAttribute("class","productImage"),productImage.style.backgroundImage=`url('${i.img}')`,productImage.style.display="inline-block",productImage.style.marginRight="1em",productImage.style.padding="3.5em",productImage.style.border="5px #ffffff solid",r.appendChild(productImage);let s=document.createElement("p");s.style.fontSize="larger",s.style.fontWeight="500",s.innerHTML=i.name;let l=document.createElement("p");l.setAttribute("class","itemPrice"),l.innerHTML="$"+i.price;let d=document.createElement("a");d.setAttribute("onclick",`removeIndexCart(${o})`),d.setAttribute("class","removeBtn"),d.innerHTML='<i class="fa-duotone fa-circle-xmark" style="padding: 0px 2px 0px 0px;"></i> Remove',a.appendChild(s),a.appendChild(l),a.appendChild(d),n.appendChild(r),n.appendChild(a),t.appendChild(n),e.appendChild(t)}let i,r=document.createElement("div"),a=0;for(let e of cart)e.id&&(i=e.price,a+=parseInt(i));r.innerHTML=`<div style="margin:1.5em;font-size:1.8rem;">Total Order Price: $${a}`;let s=document.createElement("div");s.setAttribute("class","xButton"),s.addEventListener("click",createOrder),s.innerText="Complete Your Order",s.style.display="inline-block",s.style.marginTop="1em";let l=document.createElement("div");l.style.fontSize="20px",l.style.marginTop="2em",l.innerHTML="There are no items in your shopping cart...",0===cart.length?e.appendChild(l):(e.appendChild(r),e.appendChild(s)),document.getElementById("editAccountContainer").style.display="none",document.getElementById("contentContainer").style.display="none",document.getElementById("orderContainer").style.display="none",document.getElementById("orderHistoryItemContainer").style.display="none",document.getElementById("storeContainer").style.display="none",document.getElementById("storeItemContainer").style.display="none",e.style.display="inline-block"}main();const toggle=document.querySelector(".toggle"),menu=document.querySelector(".menu"),items=document.querySelectorAll(".item"),v=[...document.body.querySelectorAll("[id]")].reduce(((e,t)=>(e[t.id]=document.getElementById(t.id),e)),{});function main(){document.getElementById("storeItemContainer").innerHTML="",getResource("assets/html/main.html")}function loginFetch(){getResource("assets/html/login.html")}function signupFetch(){getResource("assets/html/signup.html")}async function getResource(e){let t=await fetch(e),n=await t.text();t&&hideloader(),parseHtml(n)}function parseHtml(e){let t=(new DOMParser).parseFromString(e,"text/html"),n=(new XMLSerializer).serializeToString(t);v.storeContainer.style.display="none",v.cartContainer.style.display="none",v.orderContainer.style.display="none",v.contentContainer.innerHTML=n,v.contentContainer.style.display="inline-block",v.orderHistoryItemContainer.style.display="none",v.editAccountContainer.style.display="none"}v.homeLogo.addEventListener("click",main),toggle.addEventListener("click",toggleMenu,!1);let searchOpenStore=function(e){0==$("#storeContainer:visible").length&&e.length>=1&&getStore()};function message(e,t){"alert"==e?(v.alertMessage.innerHTML=t,v.alert.style.display="inline-block"):"success"==e?(v.successMessage.innerHTML=t,v.success.style.display="inline-block"):"info"==e&&(v.infoMessage.innerHTML=t,v.info.style.display="inline-block");let n=[{transform:"translateX(0)",opacity:"1"},{transform:"translateX(25px)",opacity:"0"}],o={duration:280,iterations:1};setTimeout((function(){document.getElementById(e).animate(n,o),document.getElementById(e).webkitAnimationPlayState="paused"}),3e3),setTimeout((function(){document.getElementById(e).style.display="none"}),3280)}function hideloader(){document.getElementById("loading").style.display="none"}function toggleMenu(){menu.classList.contains("active")?(menu.classList.remove("active"),toggle.querySelector("a").innerHTML="<i class='fas fa-bars'></i>"):(menu.classList.add("active"),toggle.querySelector("a").innerHTML="<i class='fas fa-times'></i>")}function toggleItem(){this.classList.contains("submenu-active")?this.classList.remove("submenu-active"):menu.querySelector(".submenu-active")?(menu.querySelector(".submenu-active").classList.remove("submenu-active"),this.classList.add("submenu-active")):this.classList.add("submenu-active")}function closeSubmenu(e){menu.querySelector(".submenu-active")&&!menu.querySelector(".submenu-active").contains(e.target)&&menu.querySelector(".submenu-active")&&menu.querySelector(".submenu-active").classList.remove("submenu-active")}for(let e of items)e.querySelector(".submenu")&&e.addEventListener("click",toggleItem,!1),e.addEventListener("keypress",toggleItem,!1);document.addEventListener("click",closeSubmenu,!1),navigator.serviceWorker&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("/service_worker.js").then((e=>{})).catch((e=>{}))}));